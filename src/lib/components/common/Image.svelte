<script lang="ts">
	import { run } from 'svelte/legacy';

	import { WEBUI_BASE_URL } from '$lib/constants';

	import { settings } from '$lib/stores';
	import ImagePreview from './ImagePreview.svelte';
	import XMark from '$lib/components/icons/XMark.svelte';
	import { getContext } from 'svelte';




	interface Props {
		src?: string;
		alt?: string;
		className?: any;
		imageClassName?: string;
		dismissible?: boolean;
		onDismiss?: any;
	}

	let {
		src = '',
		alt = '',
		className = ` w-full ${($settings?.highContrastMode ?? false) ? '' : 'outline-hidden focus:outline-hidden'}`,
		imageClassName = 'rounded-lg',
		dismissible = false,
		onDismiss = () => {}
	}: Props = $props();

	const i18n = getContext('i18n');

	let _src = $state('');
	run(() => {
		_src = src.startsWith('/') ? `${WEBUI_BASE_URL}${src}` : src;
	});

	let showImagePreview = $state(false);
</script>

<ImagePreview bind:show={showImagePreview} src={_src} {alt} />

<div class=" relative group w-fit flex items-center">
	<button
		class={className}
		onclick={() => {
			showImagePreview = true;
		}}
		aria-label={$i18n.t('Show image preview')}
		type="button"
	>
		<img src={_src} {alt} class={imageClassName} draggable="false" data-cy="image" />
	</button>

	{#if dismissible}
		<div class=" absolute -top-1 -right-1">
			<button
				aria-label={$i18n.t('Remove image')}
				class=" bg-white text-black border border-white rounded-full group-hover:visible invisible transition"
				type="button"
				onclick={() => {
					onDismiss();
				}}
			>
				<XMark className={'size-4'} />
			</button>
		</div>
	{/if}
</div>
